<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIFAR-10 Project</title>
    <style>
        /* Keeping all your original styles */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #0f172a; color: #e2e8f0; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid #334155; }
        h1 { font-size: 3rem; background: linear-gradient(90deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; background-clip: text; color: transparent; margin-bottom: 1rem; }
        h2 { font-size: 2rem; color: #94a3b8; margin-bottom: 1.5rem; }
        h3 { color: #cbd5e1; margin-bottom: 1rem; }
        .intro { font-size: 1.2rem; color: #cbd5e1; max-width: 800px; margin: 0 auto 2rem; text-align: center; }
        .model-types { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin: 2rem 0 3rem; }
        .model-card { background-color: #1e293b; border-radius: 10px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: transform 0.3s, box-shadow 0.3s; }
        .model-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2); }
        .model-card.mlp { border-top: 4px solid #3b82f6; }
        .model-card.cnn { border-top: 4px solid #10b981; }
        .model-card.vae { border-top: 4px solid #8b5cf6; }
        .model-name { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .model-desc { color: #94a3b8; font-size: 0.95rem; }
        .actions { display: flex; justify-content: center; gap: 2rem; margin: 3rem 0; }
        .action-btn { padding: 1rem 2.5rem; font-size: 1.2rem; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; display: flex; align-items: center; gap: 0.5rem; }
        .classify-btn { background-color: #3b82f6; color: white; }
        .generate-btn { background-color: #8b5cf6; color: white; }
        .action-btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        .developer { margin-top: 4rem; padding-top: 2rem; border-top: 1px solid #334155; text-align: center; }
        .developer h3 { color: #3b82f6; margin-bottom: 0.5rem; }
        .page { display: none; }
        .page.active { display: block; }
        .back-btn { background-color: #475569; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; margin-bottom: 2rem; display: flex; align-items: center; gap: 0.5rem; }
        .upload-area { background-color: #1e293b; border: 2px dashed #475569; border-radius: 10px; padding: 3rem; text-align: center; margin: 2rem 0; transition: border-color 0.3s; }
        .upload-area.dragover { border-color: #3b82f6; background-color: #1e293b; }
        .upload-area p { margin-bottom: 1rem; color: #94a3b8; }
        .upload-btn { background-color: #475569; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer; font-weight: 600; }
        .model-selector { margin-bottom: 2rem; }
        .model-selector select { background-color: #1e293b; color: white; border: 1px solid #475569; padding: 0.8rem; border-radius: 5px; width: 300px; font-size: 1rem; }
        .preview-container { text-align: center; margin-bottom: 2rem; }
        .preview-image { max-width: 300px; max-height: 300px; border-radius: 8px; margin-top: 1rem; border: 2px solid #475569; }
        .classify-btn-page { background-color: #10b981; color: white; border: none; padding: 1rem 2rem; font-size: 1.1rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 1rem 0 2rem; }
        .results-container { background-color: #1e293b; border-radius: 10px; padding: 2rem; margin-top: 2rem; }
        .results-header { display: flex; justify-content: space-between; margin-bottom: 1.5rem; }
        .predicted-class { font-size: 1.5rem; color: #10b981; }
        .confidence { font-size: 1.2rem; color: #fbbf24; }
        .results-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        @media (min-width: 768px) { .results-grid { grid-template-columns: repeat(5, 1fr); } }
        .class-item { background-color: #0f172a; padding: 1rem; border-radius: 8px; text-align: center; }
        .class-name { font-weight: 600; margin-bottom: 0.5rem; }
        .class-percent { color: #94a3b8; }
        .class-selector { margin-bottom: 2rem; }
        .class-selector select { background-color: #1e293b; color: white; border: 1px solid #475569; padding: 0.8rem; border-radius: 5px; width: 300px; font-size: 1rem; }
        .generate-btn-page { background-color: #8b5cf6; color: white; border: none; padding: 1rem 2rem; font-size: 1.1rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 1rem 0 2rem; }
        .generated-image-container { text-align: center; margin: 3rem 0; }
        .generated-image { max-width: 300px; max-height: 300px; border-radius: 8px; margin-top: 1rem; border: 2px solid #8b5cf6; background-color: #1e293b; padding: 1rem; }
        .loading { display: none; text-align: center; margin: 2rem 0; color: #94a3b8; }
        .loading.active { display: block; }
        .spinner { border: 4px solid #1e293b; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .footer { text-align: center; margin-top: 3rem; color: #64748b; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div id="home-page" class="page active">
        <div class="container">
            <header>
                <h1>CIFAR-10 Project</h1>
                <p class="intro">
                    CIFAR-10 is a dataset of 60,000 color images (32√ó32) across 10 classes. 
                    This interface connects to a <strong>Python Flask Backend</strong> to run real .h5 models.
                </p>
            </header>
            
            <section>
                <h2>Model Types Explained</h2>
                <div class="model-types">
                    <div class="model-card mlp">
                        <div class="model-name">MLP</div>
                        <p class="model-desc">Multilayer Perceptron. Requires flattening 32x32x3 images into a single vector.</p>
                    </div>
                    <div class="model-card cnn">
                        <div class="model-name">CNN</div>
                        <p class="model-desc">Convolutional Neural Network. Processes the 32x32x3 image structure directly.</p>
                    </div>
                    <div class="model-card vae">
                        <div class="model-name">VAE</div>
                        <p class="model-desc">Variational Autoencoder. (Generation feature simulation only).</p>
                    </div>
                </div>
            </section>
            
            <section>
                <h2>Choose an Action</h2>
                <div class="actions">
                    <button class="action-btn classify-btn" onclick="showPage('classification-page')">
                        <span>üìä</span> Classify Image
                    </button>
                    <button class="action-btn generate-btn" onclick="showPage('generate-page')">
                        <span>üé®</span> Generate Image
                    </button>
                </div>
            </section>
            
            <section class="developer">
                <h3>Developer</h3>
                <p><strong>Chernet Erdachew</strong></p>
                <p>Email: cherneterdachew@gmail.com</p>
            </section>
        </div>
    </div>
    
    <div id="classification-page" class="page">
        <div class="container">
            <button class="back-btn" onclick="showPage('home-page')">
                <span>‚Üê</span> Back to Home
            </button>
            
            <h2>Image Classification</h2>
            <p>Upload any image. It will be resized to 32x32 and processed by your Python backend.</p>
            
            <div class="model-selector">
                <label for="model-select"><strong>Select Model:</strong></label><br>
                <select id="model-select">
                    <option value="mlp">MLP Model (cifar10_mlp_classification_model.h5)</option>
                    <option value="cnn">CNN Model (cifar10_cnn_classification_model.h5)</option>
                </select>
            </div>
            
            <div class="upload-area" id="upload-area">
                <p>Drag & drop an image here, or click to browse</p>
                <button class="upload-btn" onclick="document.getElementById('file-input').click()">Browse Files</button>
                <input type="file" id="file-input" accept="image/*" style="display: none;">
            </div>
            
            <div class="preview-container">
                <div id="image-preview"></div>
            </div>
            
            <button class="classify-btn-page" onclick="classifyImage()">Identify Class</button>
            
            <div class="loading" id="classify-loading">
                <div class="spinner"></div>
                <p>Sending to Python backend for prediction...</p>
            </div>
            
            <div class="results-container" id="results-container" style="display: none;">
                <div class="results-header">
                    <div class="predicted-class" id="predicted-class">Predicted: -</div>
                    <div class="confidence" id="confidence">Confidence: -</div>
                </div>
                
                <h3>Class Probabilities:</h3>
                <div class="results-grid" id="results-grid">
                    </div>
            </div>
        </div>
    </div>
    
    <div id="generate-page" class="page">
        <div class="container">
            <button class="back-btn" onclick="showPage('home-page')">
                <span>‚Üê</span> Back to Home
            </button>
            <h2>Generate New Image (Simulation)</h2>
            <p>Select a class. (Note: Backend implementation focused on Classification).</p>
            <div class="class-selector">
                <select id="class-select">
                    <option value="0">Airplane</option><option value="1">Automobile</option><option value="2">Bird</option>
                    <option value="3">Cat</option><option value="4">Deer</option><option value="5">Dog</option>
                    <option value="6">Frog</option><option value="7">Horse</option><option value="8">Ship</option><option value="9">Truck</option>
                </select>
            </div>
            <button class="generate-btn-page" onclick="generateImage()">Generate Image</button>
            <div class="loading" id="generate-loading"><div class="spinner"></div></div>
            <div class="generated-image-container">
                <div id="generated-image-placeholder"><p>No image generated yet.</p></div>
                <img id="generated-image" class="generated-image" style="display: none;">
            </div>
        </div>
    </div>

    <script>
        const labels = ["airplane", "automobile", "bird", "cat", "deer", "dog", "frog", "horse", "ship", "truck"];
        let selectedFile = null;

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'classification-page') {
                document.getElementById('results-container').style.display = 'none';
                document.getElementById('image-preview').innerHTML = '';
                selectedFile = null;
                document.getElementById('file-input').value = '';
            }
        }
        
        // Drag and Drop & File Logic
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');
            
            uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
            uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('dragover'); });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    selectedFile = e.dataTransfer.files[0];
                    previewImage(selectedFile);
                }
            });
            
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length) {
                    selectedFile = fileInput.files[0];
                    previewImage(selectedFile);
                }
            });
        });
        
        function previewImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('image-preview').innerHTML = `<img src="${e.target.result}" class="preview-image" alt="Preview">`;
            };
            reader.readAsDataURL(file);
        }
        
        // --- REAL BACKEND CONNECTION ---
        async function classifyImage() {
            if (!selectedFile) {
                alert('Please upload an image first.');
                return;
            }

            const modelSelect = document.getElementById('model-select').value;
            
            // UI Updates
            document.getElementById('classify-loading').classList.add('active');
            document.getElementById('results-container').style.display = 'none';
            
            // Create Form Data to send to Python
            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('model_type', modelSelect);

            try {
                // Fetch request to Python backend
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    displayResults(data.probabilities);
                } else {
                    alert('Error: ' + data.error);
                }

            } catch (error) {
                console.error('Error:', error);
                alert('Failed to connect to backend. Make sure app.py is running.');
            } finally {
                document.getElementById('classify-loading').classList.remove('active');
            }
        }

        function displayResults(probabilities) {
            // Find highest probability
            const maxProb = Math.max(...probabilities);
            const predictedIndex = probabilities.indexOf(maxProb);
            
            // Update Header
            document.getElementById('predicted-class').textContent = 
                `Predicted: ${labels[predictedIndex].charAt(0).toUpperCase() + labels[predictedIndex].slice(1)}`;
            document.getElementById('confidence').textContent = 
                `Confidence: ${(maxProb * 100).toFixed(1)}%`;
            
            // Build Grid
            const resultsGrid = document.getElementById('results-grid');
            resultsGrid.innerHTML = '';
            
            labels.forEach((label, index) => {
                const percent = (probabilities[index] * 100).toFixed(1);
                const isPredicted = index === predictedIndex;
                
                const classItem = document.createElement('div');
                classItem.className = 'class-item';
                classItem.innerHTML = `
                    <div class="class-name" style="color: ${isPredicted ? '#10b981' : '#cbd5e1'}">
                        ${label.charAt(0).toUpperCase() + label.slice(1)}
                    </div>
                    <div class="class-percent" style="font-weight: ${isPredicted ? 'bold' : 'normal'}">
                        ${percent}%
                    </div>
                    <div style="width: 100%; background: #334155; height: 6px; border-radius: 3px; margin-top: 5px;">
                        <div style="width: ${percent}%; background: ${isPredicted ? '#10b981' : '#3b82f6'}; height: 100%; border-radius: 3px;"></div>
                    </div>
                `;
                resultsGrid.appendChild(classItem);
            });
            
            document.getElementById('results-container').style.display = 'block';
        }

        // --- SIMULATION FOR GENERATION (Kept separate) ---
        function generateImage() {
            document.getElementById('generate-loading').classList.add('active');
            setTimeout(() => {
                document.getElementById('generate-loading').classList.remove('active');
                const img = document.getElementById('generated-image');
                img.src = "https://via.placeholder.com/300?text=VAE+Simulation"; 
                img.style.display = 'block';
                document.getElementById('generated-image-placeholder').style.display = 'none';
            }, 1000);
        }
    </script>
</body>
</html>